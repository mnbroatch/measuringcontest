{
  "entities": [
    {
      "name": "mainGrid",
      "type": "Grid",
      "width": 8,
      "height": 8
    },
    {
      "name": "checker",
      "perPlayer": true,
      "state": { 
        "isKing": false
      },
      "displayProperties": ["isKing", "entityId"],
      "count": 12
    }
  ],
  "sharedBoard": [{ "name": "mainGrid" }],
  "initialPlacements": [
    {"entity": {"name": "checker", "player": "1"}, "destination": {"index": 55}},
    {"entity": {"name": "checker", "player": "0"}, "destination": {"index": 8}}
  ],
  "minPlayers": 2,
  "maxPlayers": 2,
  "turn": {
    "activePlayers": { "currentPlayer": "jumpIfPossible" },
    "stages": {
      "jumpIfPossible": {
        "initialMoves": [{
          "type": "SetActivePlayers",
          "options": {
            "currentPlayer": { "stage": "moveIfNoJump" }
          },
          "conditions": [{ "type": "NoPossibleMoves" }]
        }],
        "moves": {
          "jumpChecker": {
            "type": "MoveEntity",
            "arguments": {
              "entity": {
                "playerChoice": true,
                "constraints": [
                  {
                    "type": "Is",
                    "matcher": {
                      "name": "checker",
                      "player": {
                        "type": "ctxPath",
                        "path": ["currentPlayer"]
                      }
                    }
                  }
                ]
              },
              "destination": {
                "playerChoice": true,
                "constraints": [
                  {
                    "type": "Is",
                    "matcher": { "type": "Space" }
                  },
                  {
                    "type": "Not",
                    "conditions": [{ "type": "Contains" }]
                  },
                  {
                    "type": "Or",
                    "conditions": [
                      {
                        "type": "Contains",
                        "target": {
                          "type": "RelativeCoordinates",
                          "location": {
                            "type": "expression",
                            "expression": "player == '0' ? player0RelativeCoordinates : player1RelativeCoordinates",
                            "arguments": {
                              "player0RelativeCoordinates": [-2, 2],
                              "player1RelativeCoordinates": [-2, -2],
                              "player": {
                                "type": "ctxPath",
                                "path": ["currentPlayer"]
                              }
                            }
                          }
                        },
                        "conditions": [{
                          "type": "Is",
                          "entity": {
                            "type": "contextPath",
                            "path": ["moveArguments", "entity"]
                          }
                        }]
                      },
                      {
                        "type": "Contains",
                        "target": {
                          "type": "RelativeCoordinates",
                          "location": {
                            "type": "expression",
                            "expression": "player == '0' ? player0RelativeCoordinates : player1RelativeCoordinates",
                            "arguments": {
                              "player0RelativeCoordinates": [2, 2],
                              "player1RelativeCoordinates": [2, -2],
                              "player": {
                                "type": "ctxPath",
                                "path": ["currentPlayer"]
                              }
                            }
                          }
                        },
                        "conditions": [{
                          "type": "Is",
                          "entity": {
                            "type": "contextPath",
                            "path": ["moveArguments", "entity"]
                          }
                        }]
                      },
                      {
                        "type": "Contains",
                        "target": {
                          "type": "RelativeCoordinates",
                          "location": {
                            "type": "expression",
                            "expression": "player == '0' ? player0RelativeCoordinates : player1RelativeCoordinates",
                            "arguments": {
                              "player0RelativeCoordinates": [-2, -2],
                              "player1RelativeCoordinates": [-2, 2],
                              "player": {
                                "type": "ctxPath",
                                "path": ["currentPlayer"]
                              }
                            }
                          }
                        },
                        "conditions": [
                          {
                            "type": "Is",
                            "entity": {
                              "type": "contextPath",
                              "path": ["moveArguments", "entity"]
                            }
                          },
                          {
                            "type": "Is",
                            "matcher": { "isKing": true }
                          }
                        ]
                      },
                      {
                        "type": "Contains",
                        "target": {
                          "type": "RelativeCoordinates",
                          "location": {
                            "type": "expression",
                            "expression": "player == '0' ? player0RelativeCoordinates : player1RelativeCoordinates",
                            "arguments": {
                              "player0RelativeCoordinates": [2, -2],
                              "player1RelativeCoordinates": [2, 2],
                              "player": {
                                "type": "ctxPath",
                                "path": ["currentPlayer"]
                              }
                            }
                          }
                        },
                        "conditions": [
                          {
                            "type": "Is",
                            "entity": {
                              "type": "contextPath",
                              "path": ["moveArguments", "entity"]
                            }
                          },
                          {
                            "type": "Is",
                            "matcher": { "isKing": true }
                          }
                        ]
                      }
                    ]
                  },
                  {
                    "type": "InLine",
                    "sequence": [
                      {
                        "conditions": [{
                          "type": "Contains",
                          "conditions": [{
                            "type": "Is",
                            "entity": {
                              "type": "contextPath",
                              "path": ["moveArguments", "entity"]
                            }
                          }]
                        }]
                      },
                      {
                        "conditions": [{
                          "type": "Contains",
                          "conditions": [{
                            "type": "Not",
                            "conditions": [{
                              "type": "Is",
                              "matcher": {
                                "player": {
                                  "type": "ctxPath",
                                  "path": ["currentPlayer"]
                                }
                              }
                            }]
                          }]
                        }]
                      },
                      {
                        "conditions": [{
                          "type": "Is",
                          "entity": {
                            "type": "contextPath",
                            "path": ["originalTarget"]
                          }
                        }]
                      }
                    ]
                  }
                ]
              }
            },
            "then": [
              {
                "type": "ForEach",
                "arguments": {
                  "targets": {
                    "type": "contextPath",
                    "path": [
                      "moveConditionResults",
                      0,
                      "conditionResults",
                      "argumentResults",
                      "destination",
                      "results",
                      0,
                      "results",
                      3,
                      "matches",
                      0,
                      1,
                      "entities"
                    ]
                  }
                },
                "move": {
                  "type": "RemoveEntity",
                  "arguments": {
                    "entity": {
                      "type": "contextPath",
                      "path": [ "loopTarget" ]
                    }
                  }
                }
              },
              {
                "type": "SetActivePlayers",
                "options": {
                  "currentPlayer": { "stage": "keepJumping" }
                }
              }
            ]
          }
        }
      },
      "keepJumping": {
        "initialMoves": [{
          "type": "SetActivePlayers",
          "options": {
            "currentPlayer": { "stage": "kingPieces" }
          },
          "conditions": [{ "type": "NoPossibleMoves" }]
        }],
        "moves": {
          "jumpChecker": {
            "type": "MoveEntity",
            "arguments": {
              "entity": {
                "constraints": [
                  {
                    "type": "Is",
                    "entity": {
                      "type": "gamePath",
                      "path": ["_meta", "previousPayloads", "jumpChecker", "arguments", "entity"]
                    }
                  }
                ]
              },
              "destination": {
                "playerChoice": true,
                "constraints": [
                  {
                    "type": "Is",
                    "matcher": { "type": "Space" }
                  },
                  {
                    "type": "Not",
                    "conditions": [{ "type": "Contains" }]
                  },
                  {
                    "type": "Or",
                    "conditions": [
                      {
                        "type": "Contains",
                        "target": {
                          "type": "RelativeCoordinates",
                          "location": {
                            "type": "expression",
                            "expression": "player == '0' ? player0RelativeCoordinates : player1RelativeCoordinates",
                            "arguments": {
                              "player0RelativeCoordinates": [-2, 2],
                              "player1RelativeCoordinates": [-2, -2],
                              "player": {
                                "type": "ctxPath",
                                "path": ["currentPlayer"]
                              }
                            }
                          }
                        },
                        "conditions": [{
                          "type": "Is",
                          "entity": {
                            "type": "contextPath",
                            "path": ["moveArguments", "entity"]
                          }
                        }]
                      },
                      {
                        "type": "Contains",
                        "target": {
                          "type": "RelativeCoordinates",
                          "location": {
                            "type": "expression",
                            "expression": "player == '0' ? player0RelativeCoordinates : player1RelativeCoordinates",
                            "arguments": {
                              "player0RelativeCoordinates": [2, 2],
                              "player1RelativeCoordinates": [2, -2],
                              "player": {
                                "type": "ctxPath",
                                "path": ["currentPlayer"]
                              }
                            }
                          }
                        },
                        "conditions": [{
                          "type": "Is",
                          "entity": {
                            "type": "contextPath",
                            "path": ["moveArguments", "entity"]
                          }
                        }]
                      },
                      {
                        "type": "Contains",
                        "target": {
                          "type": "RelativeCoordinates",
                          "location": {
                            "type": "expression",
                            "expression": "player == '0' ? player0RelativeCoordinates : player1RelativeCoordinates",
                            "arguments": {
                              "player0RelativeCoordinates": [-2, -2],
                              "player1RelativeCoordinates": [-2, 2],
                              "player": {
                                "type": "ctxPath",
                                "path": ["currentPlayer"]
                              }
                            }
                          }
                        },
                        "conditions": [
                          {
                            "type": "Is",
                            "entity": {
                              "type": "contextPath",
                              "path": ["moveArguments", "entity"]
                            }
                          },
                          {
                            "type": "Is",
                            "matcher": { "isKing": true }
                          }
                        ]
                      },
                      {
                        "type": "Contains",
                        "target": {
                          "type": "RelativeCoordinates",
                          "location": {
                            "type": "expression",
                            "expression": "player == '0' ? player0RelativeCoordinates : player1RelativeCoordinates",
                            "arguments": {
                              "player0RelativeCoordinates": [2, -2],
                              "player1RelativeCoordinates": [2, 2],
                              "player": {
                                "type": "ctxPath",
                                "path": ["currentPlayer"]
                              }
                            }
                          }
                        },
                        "conditions": [
                          {
                            "type": "Is",
                            "entity": {
                              "type": "contextPath",
                              "path": ["moveArguments", "entity"]
                            }
                          },
                          {
                            "type": "Is",
                            "matcher": { "isKing": true }
                          }
                        ]
                      }
                    ]
                  },
                  {
                    "type": "InLine",
                    "sequence": [
                      {
                        "conditions": [{
                          "type": "Contains",
                          "conditions": [{
                            "type": "Is",
                            "entity": {
                              "type": "contextPath",
                              "path": ["moveArguments", "entity"]
                            }
                          }]
                        }]
                      },
                      {
                        "conditions": [{
                          "type": "Contains",
                          "conditions": [{
                            "type": "Not",
                            "conditions": [{
                              "type": "Is",
                              "matcher": {
                                "player": {
                                  "type": "ctxPath",
                                  "path": ["currentPlayer"]
                                }
                              }
                            }]
                          }]
                        }]
                      },
                      {
                        "conditions": [{
                          "type": "Is",
                          "entity": {
                            "type": "contextPath",
                            "path": ["originalTarget"]
                          }
                        }]
                      }
                    ]
                  }
                ]
              }
            },
            "then": [
              {
                "type": "ForEach",
                "arguments": {
                  "targets": {
                    "type": "contextPath",
                    "path": [
                      "moveConditionResults",
                      0,
                      "conditionResults",
                      "argumentResults",
                      "destination",
                      "results",
                      0,
                      "results",
                      3,
                      "matches",
                      0,
                      1,
                      "entities"
                    ]
                  }
                },
                "move": {
                  "type": "RemoveEntity",
                  "arguments": {
                    "entity": {
                      "type": "contextPath",
                      "path": [ "loopTarget" ]
                    }
                  }
                }
              },
              {
                "type": "SetActivePlayers",
                "options": {
                  "currentPlayer": { "stage": "kingPieces" }
                },
                "conditions": [{ "type": "NoPossibleMoves" }]
              }
            ]
          }
        }
      },
      "moveIfNoJump": {
        "moves": {
          "moveChecker": {
            "type": "MoveEntity",
            "arguments": {
              "entity": {
                "playerChoice": true,
                "constraints": [
                  {
                    "type": "Is",
                    "matcher": {
                      "name": "checker",
                      "player": {
                        "type": "ctxPath",
                        "path": ["currentPlayer"]
                      }
                    }
                  }
                ]
              },
              "destination": {
                "playerChoice": true,
                "constraints": [
                  {
                    "type": "Is",
                    "matcher": { "type": "Space" }
                  },
                  {
                    "type": "Not",
                    "conditions": [{ "type": "Contains" }]
                  },
                  {
                    "type": "Or",
                    "conditions": [
                      {
                        "type": "Contains",
                        "target": {
                          "type": "RelativeCoordinates",
                          "location": {
                            "type": "expression",
                            "expression": "player == '0' ? player0RelativeCoordinates : player1RelativeCoordinates",
                            "arguments": {
                              "player0RelativeCoordinates": [-1, 1],
                              "player1RelativeCoordinates": [-1, -1],
                              "player": {
                                "type": "ctxPath",
                                "path": ["currentPlayer"]
                              }
                            }
                          }
                        },
                        "conditions": [{
                          "type": "Is",
                          "entity": {
                            "type": "contextPath",
                            "path": ["moveArguments", "entity"]
                          }
                        }]
                      },
                      {
                        "type": "Contains",
                        "target": {
                          "type": "RelativeCoordinates",
                          "location": {
                            "type": "expression",
                            "expression": "player == '0' ? player0RelativeCoordinates : player1RelativeCoordinates",
                            "arguments": {
                              "player0RelativeCoordinates": [1, 1],
                              "player1RelativeCoordinates": [1, -1],
                              "player": {
                                "type": "ctxPath",
                                "path": ["currentPlayer"]
                              }
                            }
                          }
                        },
                        "conditions": [{
                          "type": "Is",
                          "entity": {
                            "type": "contextPath",
                            "path": ["moveArguments", "entity"]
                          }
                        }]
                      },
                      {
                        "type": "Contains",
                        "target": {
                          "type": "RelativeCoordinates",
                          "location": {
                            "type": "expression",
                            "expression": "player == '0' ? player0RelativeCoordinates : player1RelativeCoordinates",
                            "arguments": {
                              "player0RelativeCoordinates": [-1, -1],
                              "player1RelativeCoordinates": [-1, 1],
                              "player": {
                                "type": "ctxPath",
                                "path": ["currentPlayer"]
                              }
                            }
                          }
                        },
                        "conditions": [
                          {
                            "type": "Is",
                            "entity": {
                              "type": "contextPath",
                              "path": ["moveArguments", "entity"]
                            }
                          },
                          {
                            "type": "Is",
                            "matcher": { "isKing": true }
                          }
                        ]
                      },
                      {
                        "type": "Contains",
                        "target": {
                          "type": "RelativeCoordinates",
                          "location": {
                            "type": "expression",
                            "expression": "player == '0' ? player0RelativeCoordinates : player1RelativeCoordinates",
                            "arguments": {
                              "player0RelativeCoordinates": [1, -1],
                              "player1RelativeCoordinates": [1, 1],
                              "player": {
                                "type": "ctxPath",
                                "path": ["currentPlayer"]
                              }
                            }
                          }
                        },
                        "conditions": [
                          {
                            "type": "Is",
                            "entity": {
                              "type": "contextPath",
                              "path": ["moveArguments", "entity"]
                            }
                          },
                          {
                            "type": "Is",
                            "matcher": { "isKing": true }
                          }
                        ]
                      }
                    ]
                  }
                ]
              }
            },
            "then": [
              {
                "type": "SetActivePlayers",
                "options": {
                  "currentPlayer": { "stage": "kingPieces" }
                },
                "conditions": [{ "type": "NoPossibleMoves" }]
              }
            ]
          }
        }
      },
      "kingPieces": {
        "initialMoves": [
          {
            "type": "SetState",
            "arguments": {
              "entity": {
                "type": "gamePath",
                "path": ["_meta", "previousPayloads", "jumpChecker", "arguments", "entity"]
              },
              "state": {
                "property": "isKing",
                "value": true
              }
            },
            "conditions": [{
              "type": "Evaluate",
              "expression": "(player == '0' and destinationCoordinates[1] == 0) or (player == '1' and destinationCoordinates[1] == 7)",
              "arguments": {
                "player": {
                  "type": "RelativePath",
                  "target": {
                    "type": "contextPath",
                    "path": ["previousArguments", "entity"]
                  },
                  "path": ["player"]
                },
                "destinationCoordinates": {
                  "type": "Coordinates",
                  "target": {
                    "type": "contextPath",
                    "path": ["previousArguments", "destination"]
                  }
                }
              }
            }]
          },
          { "type": "EndTurn" }
        ]
      }
    }
  },
  "endIf": [
    {
      "conditions": [{
        "type": "Not",
        "target": {
          "constraints": [{
            "type": "Is",
            "matcher": { "player": "0" }
          }]
        }
      }],
      "result": {
        "winner": 1
      }
    },
    {
      "conditions": [{
        "type": "Not",
        "target": {
          "constraints": [{
            "type": "Is",
            "matcher": { "player": "1" }
          }]
        }
      }],
      "result": {
        "winner": 0
      }
    }
  ]
}
