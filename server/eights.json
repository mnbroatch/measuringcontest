{
  "DEBUG_DISABLE_SECRET_STATE": true,
  "entities": [
    {
      "name": "score",
      "perPlayer": true,
      "displayProperties": ["value"],
      "state": { "value": 0 }
    },
    {
      "type": "Space",
      "name": "hand",
      "perPlayer": true,
      "contentsHiddenFrom": "Others"
    },
    {
      "type": "Space",
      "name": "discard"
    },
    {
      "type": "Space",
      "name": "stock",
      "contentsHiddenFrom": "All"
    },
    {"value": 2, "suit": "clubs", "displayProperties": ["displayName"], "displayName": "2c", "name": "card"},
    {"value": 3, "suit": "clubs", "displayProperties": ["displayName"], "displayName": "3c", "name": "card"},
    {"value": 4, "suit": "clubs", "displayProperties": ["displayName"], "displayName": "4c", "name": "card"},
    {"value": 5, "suit": "clubs", "displayProperties": ["displayName"], "displayName": "5c", "name": "card"},
    {"value": 6, "suit": "clubs", "displayProperties": ["displayName"], "displayName": "6c", "name": "card"},
    {"value": 7, "suit": "clubs", "displayProperties": ["displayName"], "displayName": "7c", "name": "card"},
    {"value": 8, "suit": "clubs", "displayProperties": ["displayName"], "displayName": "8c", "name": "card"},
    {"value": 9, "suit": "clubs", "displayProperties": ["displayName"], "displayName": "9c", "name": "card"}
  ],
  "sharedBoard": [
    { "name": "stock" },
    { "name": "discard" }
  ],
  "personalBoard": [
    { "name": "hand" },
    { "name": "score" }
  ],
  "minPlayers": 2,
  "maxPlayers": 5,
  "phases": {
    "play": {
      "start": true,
      "next": "score",
      "initialMoves": [
        {
          "type": "PlaceNew",
          "matchMultiple": true,
          "entity": {
            "conditions": [{
              "type": "Is",
              "matcher": { "name": "card" }
            }]
          },
          "arguments": {
            "destination": {
              "conditions": [{
                "type": "Is",
                "matcher": { "name": "stock" }
              }]
            }
          }
        },
        {
          "type": "Shuffle",
          "arguments": {
            "target": {
              "conditions": [{
                "type": "Is",
                "matcher": { "name": "stock" }
              }]
            }
          }
        },
        {
          "type": "ForEach",
          "arguments": {
            "targets": { "literal": [0] }
          },
          "move": {
            "type": "ForEach",
            "arguments": {
              "targets": { "ctxPath": ["playOrder"] }
            },
            "move": {
              "type": "MoveEntity",
              "arguments": {
                "entity": {
                  "conditions": [
                    {
                      "type": "Is",
                      "target": { "targetingType": "Parent" },
                      "matcher": { "name": "stock" }
                    },
                    {
                      "type": "Position",
                      "position": "First"
                    }
                  ]
                },
                "destination": {
                  "conditions": [
                    {
                      "type": "Is",
                      "target": { "targetingType": "Parent" },
                      "matcher": {
                        "name": "personalBoard",
                        "player": { "contextPath": ["loopTarget"] }
                      }
                    }
                  ]
                }
              }
            }
          }
        },
        {
          "type": "MoveEntity",
          "arguments": {
            "entity": {
              "conditions": [
                {
                  "type": "Is",
                  "target": { "targetingType": "Parent" },
                  "matcher": { "name": "stock" }
                },
                {
                  "type": "Position",
                  "position": "First"
                }
              ]
            },
            "destination": {
              "conditions": [
                {
                  "type": "Is",
                  "matcher": {
                    "name": "discard"
                  }
                }
              ]
            }
          }
        }
      ],
      "turn": {
        "activePlayers": { "currentPlayer": "normalPlay" },
        "initialMoves": [
          {
            "type": "ForEach",
            "conditions": [{
              "type": "Evaluate",
              "expression": "stockCount == 0",
              "arguments": {
                "stockCount": {
                  "type": "RelativePath",
                  "target": {
                    "conditions": [{
                      "type": "Is",
                      "matcher": { "name": "stock" }
                    }]
                  },
                  "path": ["entities", "length"]
                }
              }
            }],
            "arguments": {
              "targets": {
                "matchMultiple": true,
                "conditions": [
                  {
                    "type": "Is",
                    "target": { "targetingType": "Parent" },
                    "matcher": { "name": "discard" }
                  },
                  {
                    "type": "Not",
                    "conditions": [{
                      "type": "Position",
                      "position": "First"
                    }]
                  }
                ]
              }
            },
            "move": {
              "type": "MoveEntity",
              "arguments": {
                "entity": { "contextPath": ["loopTarget"] },
                "destination": {
                  "conditions": [
                    {
                      "type": "Is",
                      "matcher": {
                        "name": "stock"
                      }
                    }
                  ]
                }
              }
            }
          },
          {
            "type": "Shuffle",
            "arguments": {
              "target": {
                "conditions": [{
                  "type": "Is",
                  "matcher": { "name": "stock" }
                }]
              }
            }
          }
        ],
        "stages": {
          "normalPlay": {
            "moves": {
              "playCard": {
                "type": "MoveEntity",
                "position": "First",
                "arguments": {
                  "entity": {
                    "playerChoice": true,
                    "conditions": [
                      {
                        "type": "Is",
                        "target": { "targetingType": "Parent" },
                        "matcher": {
                          "name": "hand",
                          "player": "Current"
                        }
                      },
                      {
                        "type": "Or",
                        "conditions": [
                          {
                            "type": "Is",
                            "matcher": {
                              "value": 8
                            }
                          },
                          {
                            "type": "Is",
                            "matcher": {
                              "pick": {
                                "properties": ["suit"],
                                "target": {
                                  "conditions": [
                                    {
                                      "type": "Is",
                                      "target": { "targetingType": "Parent" },
                                      "matcher": { "name": "discard" }
                                    },
                                    {
                                      "type": "Position",
                                      "position": "First"
                                    }
                                  ]
                                }
                              }
                            }
                          },
                          {
                            "type": "Is",
                            "matcher": {
                              "pick": {
                                "properties": ["value"],
                                "target": {
                                  "conditions": [
                                    {
                                      "type": "Is",
                                      "target": { "targetingType": "Parent" },
                                      "matcher": { "name": "discard" }
                                    },
                                    {
                                      "type": "Position",
                                      "position": "First"
                                    }
                                  ]
                                }
                              }
                            }
                          }
                        ]
                      }
                    ]
                  },
                  "destination": {
                    "position": "First",
                    "conditions": [
                      {
                        "type": "Is",
                        "matcher": { "name": "discard" }
                      }
                    ]
                  }
                },
                "then": [
                  {
                    "type": "SetActivePlayers",
                    "arguments": {
                      "options": {
                        "literal": {
                          "currentPlayer": {
                            "stage": "nameSuit"
                          }
                        }
                      }
                    },
                    "conditions": [{
                      "type": "Evaluate",
                      "expression": "playedValue == 8",
                      "arguments": {
                        "playedValue": {
                          "type": "RelativePath",
                          "target": { "contextPath": ["previousArguments", "entity"] },
                          "path": ["value"]
                        }
                      }
                    }]
                  },
                  {
                    "type": "EndTurn",
                    "conditions": [{
                      "type": "Evaluate",
                      "expression": "playedValue != 8",
                      "arguments": {
                        "playedValue": {
                          "type": "RelativePath",
                          "target": { "contextPath": ["previousArguments", "entity"] },
                          "path": ["value"]
                        }
                      }
                    }]
                  }
                ]
              },
              "takeCard": {
                "type": "TakeFrom",
                "conditions": [{
                  "type": "Contains",
                  "target": {
                    "conditions": [{
                      "type": "Is",
                      "matcher": { "name": "stock" }
                    }]
                  }
                }],
                "arguments": {
                  "source": {
                    "playerChoice": true,
                    "conditions": [
                      {
                        "type": "Is",
                        "matcher": { "name": "stock" }
                      }
                    ]
                  },
                  "destination": {
                    "conditions": [
                      {
                        "type": "Is",
                        "matcher": {
                          "name": "hand",
                          "player": "Current"
                        }
                      }
                    ]
                  }
                },
                "then": [{ "type": "EndTurn" }]
              }
            }
          },
          "nameSuit": {
            "moves": {
              "nameSuit": {
                "type": "SetState",
                "arguments": {
                  "entity": {
                    "conditions": [
                      {
                        "type": "Is",
                        "target": { "targetingType": "Parent" },
                        "matcher": { "name": "discard" }
                      },
                      {
                        "type": "Position",
                        "position": "First"
                      }
                    ]
                  },
                  "state": {
                    "playerChoice": true,
                    "property": "suit",
                    "possibleValues": [ "clubs", "hearts", "spades", "diamonds" ]
                  }
                },
                "then": [{ "type": "EndTurn" }]
              }
            }
          }
        }
      },
      "endIf": [{
        "conditions": [{
          "type": "Some",
          "target": { "ctxPath": ["playOrder"] },
          "conditions": [{
            "type": "Evaluate",
            "expression": "handCount == 0",
            "arguments": {
              "handCount": {
                "type": "RelativePath",
                "target": {
                  "conditions": [{
                    "type": "Is",
                    "matcher": {
                      "name": "hand",
                      "player": { "contextPath": ["loopTarget"] }
                    }
                  }]
                },
                "path": ["entities", "length"]
              }
            }
          }]
        }],
        "result": {"blah": "bleh"}
      }]
    },
    "score": {
      "next": "play"
    }
  },
  "endIf": []
}
